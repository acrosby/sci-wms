<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

  <head>
    <title>Sci-wms: A Python WMS service for geospatial gridded data</title>
    {% load static from staticfiles %}
    <link rel="shortcut icon" href="{% static 'common/favicon.ico' %}" />
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.3/css/bootstrap.min.css" />
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.0.3/js/bootstrap.min.js"></script>
    <style>
      table { table-layout: fixed; }
      table th, table td { overflow: hidden; }
      hr { margin-top: 10px; margin-bottom: 10px; }
    </style>
  </head>

  <body>
    <div class="container">
      <div class="row">
        <div class="col-md-12">
          <div class="page-header">
            <h1>sci-wms <small>a Python WMS service for geospatial gridded data</small></h1>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-md-8">
          <ul class="nav nav-pills">
            <li><a href="{% url 'documentation' %}"><span style="color: brown" class="glyphicon glyphicon-book"></span> documentation</a></li>
            <li><a href="{% url 'demo' %}"><span style="color: green" class="glyphicon glyphicon-leaf"></span> demo (Leaflet WMS client)</a></li>
            {% if user.is_authenticated %}
            <li><a href="/wms/logout" data-toggle="modal"><span class="glyphicon glyphicon-log-out"></span> logout</a></li>
            <li><a data-toggle="collapse" href="#addDataset" aria-expanded="false" aria-controls="addDataset"><span style="color: green" class="glyphicon glyphicon-plus"></span> add dataset</a></li>
            {% else %}
            <li><a href="#login" data-toggle="modal"><span class="glyphicon glyphicon-log-in"></span> admin</a></li>
            {% endif %}
          </ul>
        </div>
      </div>

      <hr />

      {% if user.is_authenticated %}
      <div class="collapse" id="addDataset">
        <div class="panel panel-default">
          <div class="panel-body">
            <form class="form-inline" action="{% url 'add' %}" method="post">
              <div class="form-group">
                <label for="dap">OPeNDAP endpoint</label>
                <input type="text" class="form-control" name="odp" id="odp" placeholder="OPeNDAP endpoint">
              </div>
              <div class="form-group">
                <label for="description">dataset description</label>
                <input type="text" class="form-control" name="description" id="description" placeholder="dataset description">
              </div>
              <button type="submit" class="btn btn-default">add OPeNDAP dataset</button>
            </form>
          </div>
        </div>
      </div>
      {% endif %}

      {% if datasets %}
      <table class="table table-bordered table-striped table-hover" style="margin-top: 30px;">
        <thead>
          <tr>
            <th style="width: 300px">Description</th>
            <th style="width: 225px">Info</th>
            {% if user.is_authenticated %}
            <th style="width: 100px">Actions</th>
            {% endif %}
          </tr>
        </thead>
        <tbody>
          {% for dataset in datasets %}
          <tr>
            <td>
              <h4><a href="{% url 'dataset' dataset.name %}">{{ dataset.name | truncatechars:28 }}</h4></a>
              <span>{{ dataset.description }}</span>
              <span class="label label-default">{{ dataset.topology_type }}</span>
            </td>
            <td>
              <a class="row" href="{% url 'dataset' dataset.name %}?REQUEST=GetCapabilities"><span class="glyphicon glyphicon-new-window"></span> GetCapabilities</a>
              {% if dataset.online %}
              <a class="row" href="{{ dataset.uri }}.html"><span class="glyphicon glyphicon-new-window"></span> data (OPeNDAP)</a>
              {% else %}
              <abbr class="row" title="{{dataset.uri}}"><span class="glyphicon glyphicon-new-window"></span> data (local file)</abbr>
              {% endif %}
              <!-- CF compliance TODO -->
            </td>
            {% if user.is_authenticated %}
            <td>
              <a href="{% url 'remove' dataset.name %}"><button type="button" class="btn btn-default btn-xs"><span style="color: red" class="glyphicon glyphicon-remove"></span> remove</button></a>
              <a href="{% url 'refresh' dataset.name %}"><button type="button" class="btn btn-default btn-xs"><span style="color: blue" class="glyphicon glyphicon-refresh"></span> refresh</button></a>
            </td>
            {% endif %}
          </tr>
          {% endfor %}
        </tbody>
      </table>
      {% else %}
      <div class="row">
        <div class="col-md-12">
          <div class="panel panel-primary">
            <div class="panel-heading">
              <h3 class="panel-title">No datasets found.  Add datasets using the Admin link above.</a></h3>
            </div>
          </div>
        </div>
      </div>
      {% endif %}
    </div>


    <!-- Modal HTML -->
    <div id="login" class="modal fade">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
            <h4 class="modal-title">Sci-wms admin login</h4>
          </div>
          <div class="modal-body">
            <form method="post" action="/wms/login" name="loginForm">
              <p><input type="text" class="span3" name="username" id="username" placeholder="username" value=""></p>
              <p><input type="password" class="span3" id="password" name="password" placeholder="password"></p>
              <p><button type="submit" class="btn btn-success">login</button></p>
            </form>
          </div>
        </div>
      </div>
    </div>

  </body>
</html>
